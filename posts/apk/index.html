<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>AK  | Android APK hacking</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.49" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.e08a958ae3e530145318b6373195c765.css" rel="stylesheet">
    

    

    
      
    

    

    <meta property="og:title" content="Android APK hacking" />
<meta property="og:description" content="Introduction The post today is about fun, Kali Linux and Android apps hacking. Check it out!
Why? Because people hide your access and don&#39;t provide you a plain, well structured and easy to use API, no SDK, nothing. You are probalby locked in those apps, that normally share less than what you want.
Host enumeration The good old nmap should do the trick, find your network subnet, scan your hosts and look for obvious MAC address like Samsung Eletronics, for this post propouse we do have access to the cellphone, so obviously this step is not necessary." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://knabben.github.io/posts/apk/" /><meta property="article:published_time" content="2016-12-16T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2016-12-16T00:00:00&#43;00:00"/>

<meta itemprop="name" content="Android APK hacking">
<meta itemprop="description" content="Introduction The post today is about fun, Kali Linux and Android apps hacking. Check it out!
Why? Because people hide your access and don&#39;t provide you a plain, well structured and easy to use API, no SDK, nothing. You are probalby locked in those apps, that normally share less than what you want.
Host enumeration The good old nmap should do the trick, find your network subnet, scan your hosts and look for obvious MAC address like Samsung Eletronics, for this post propouse we do have access to the cellphone, so obviously this step is not necessary.">


<meta itemprop="datePublished" content="2016-12-16T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2016-12-16T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="725">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Android APK hacking"/>
<meta name="twitter:description" content="Introduction The post today is about fun, Kali Linux and Android apps hacking. Check it out!
Why? Because people hide your access and don&#39;t provide you a plain, well structured and easy to use API, no SDK, nothing. You are probalby locked in those apps, that normally share less than what you want.
Host enumeration The good old nmap should do the trick, find your network subnet, scan your hosts and look for obvious MAC address like Samsung Eletronics, for this post propouse we do have access to the cellphone, so obviously this step is not necessary."/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="http://knabben.github.io/" class="f3 fw2 hover-white no-underline white-90 dib">
      AK
    </a>
    <div class="flex-l items-center">
      
      









    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  <article class="flex-l flex-wrap justify-between mw8 center ph3 ph0-l">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        POSTS
      </p>
      <h1 class="f1 athelas mb1">Android APK hacking</h1>
      
      <time class="f6 mv4 dib tracked" datetime="2016-12-16T00:00:00Z">December 16, 2016</time>
    </header>

    <main class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><h2 id="introduction">Introduction</h2>

<p>The post today is about fun, Kali Linux and Android apps hacking. Check it out!</p>

<p>Why? Because people hide your access and don't provide you a plain, well structured and easy to use API, no SDK, nothing. You are probalby locked in those apps, that normally share less than what you want.</p>

<h2 id="host-enumeration">Host enumeration</h2>

<p>The good old nmap should do the trick, find your network subnet, scan your hosts and look for obvious MAC address like Samsung Eletronics, for this post propouse we do have access to the cellphone, so obviously this step is not necessary.</p>

<h2 id="sniffing-the-network">Sniffing the network</h2>

<p>The idea is to sniff the network with a man in the middle attack and try to find plain-text REST api access between your cellphone and the server it is trying to access, banks are going to use SSL and you will need to enable a fake certificate on the equipment before going on.</p>

<p>The ARP (address resolution protocol) is a MAC Address -> IP translation protocol, lets say my IP machine is 192.168.0.6 and I want to hit 192.168.0.10, when I send a packet for this host and don't have my MAC table filled (arp -a), I start to ask everyone of the network Who-has this IP.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">a4:02:b9:04:86:99 &gt; ff:ff:ff:ff:ff:ff, ethertype ARP <span style="color:#f92672">(</span>0x0806<span style="color:#f92672">)</span>, length <span style="color:#ae81ff">42</span>: Ethernet <span style="color:#f92672">(</span>len <span style="color:#ae81ff">6</span><span style="color:#f92672">)</span>, IPv4 <span style="color:#f92672">(</span>len <span style="color:#ae81ff">4</span><span style="color:#f92672">)</span>, Request who-has <span style="color:#ae81ff">192</span>.168.0.10 tell <span style="color:#ae81ff">192</span>.168.0.6, length <span style="color:#ae81ff">28</span>
cc:61:e5:70:b4:9e &gt; a4:02:b9:04:86:99, ethertype ARP <span style="color:#f92672">(</span>0x0806<span style="color:#f92672">)</span>, length <span style="color:#ae81ff">42</span>: Ethernet <span style="color:#f92672">(</span>len <span style="color:#ae81ff">6</span><span style="color:#f92672">)</span>, IPv4 <span style="color:#f92672">(</span>len <span style="color:#ae81ff">4</span><span style="color:#f92672">)</span>, Reply <span style="color:#ae81ff">192</span>.168.0.10 is-at cc:61:e5:70:b4:9e, length <span style="color:#ae81ff">28</span></code></pre></div>

<p>The owner send me back his MAC address, so the OS can craft the full TCP/IP packet. What we are going to do is spoof this reply and overwrite the target arp table, without his request. I am going to use arpspoof -i wlan0 -t 192.168.0.10 192.168.0.1</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#ae81ff">07</span>:30:45.655767 a4:02:b9:04:86:99 &gt; <span style="color:#ae81ff">00</span>:00:00:00:00:00, ethertype ARP <span style="color:#f92672">(</span>0x0806<span style="color:#f92672">)</span>, length <span style="color:#ae81ff">42</span>: Ethernet <span style="color:#f92672">(</span>len <span style="color:#ae81ff">6</span><span style="color:#f92672">)</span>, IPv4 <span style="color:#f92672">(</span>len <span style="color:#ae81ff">4</span><span style="color:#f92672">)</span>, Reply <span style="color:#ae81ff">192</span>.168.0.1 is-at a4:02:b9:04:86:99, length <span style="color:#ae81ff">28</span>
<span style="color:#ae81ff">07</span>:30:47.655964 a4:02:b9:04:86:99 &gt; <span style="color:#ae81ff">00</span>:00:00:00:00:00, ethertype ARP <span style="color:#f92672">(</span>0x0806<span style="color:#f92672">)</span>, length <span style="color:#ae81ff">42</span>: Ethernet <span style="color:#f92672">(</span>len <span style="color:#ae81ff">6</span><span style="color:#f92672">)</span>, IPv4 <span style="color:#f92672">(</span>len <span style="color:#ae81ff">4</span><span style="color:#f92672">)</span>, Reply <span style="color:#ae81ff">192</span>.168.0.1 is-at a4:02:b9:04:86:99, length <span style="color:#ae81ff">28</span>
<span style="color:#ae81ff">07</span>:30:49.656158 a4:02:b9:04:86:99 &gt; <span style="color:#ae81ff">00</span>:00:00:00:00:00, ethertype ARP <span style="color:#f92672">(</span>0x0806<span style="color:#f92672">)</span>, length <span style="color:#ae81ff">42</span>: Ethernet <span style="color:#f92672">(</span>len <span style="color:#ae81ff">6</span><span style="color:#f92672">)</span>, IPv4 <span style="color:#f92672">(</span>len <span style="color:#ae81ff">4</span><span style="color:#f92672">)</span>, Reply <span style="color:#ae81ff">192</span>.168.0.1 is-at a4:02:b9:04:86:99, length <span style="color:#ae81ff">28</span>
<span style="color:#ae81ff">07</span>:30:51.656306 a4:02:b9:04:86:99 &gt; <span style="color:#ae81ff">00</span>:00:00:00:00:00, ethertype ARP <span style="color:#f92672">(</span>0x0806<span style="color:#f92672">)</span>, length <span style="color:#ae81ff">42</span>: Ethernet <span style="color:#f92672">(</span>len <span style="color:#ae81ff">6</span><span style="color:#f92672">)</span>, IPv4 <span style="color:#f92672">(</span>len <span style="color:#ae81ff">4</span><span style="color:#f92672">)</span>, Reply <span style="color:#ae81ff">192</span>.168.0.1 is-at a4:02:b9:04:86:99, length <span style="color:#ae81ff">28</span></code></pre></div>

<p>It keeps saying: Hey. target .10, your default gateway is on (a4:02...). The problem is, a4:02... is my own machine mac address, so the target starts to send his packets to my MAC (the network switch equipment will do it), and with a simple TCPdump command I can start to learn about the target.</p>

<h2 id="ssl">SSL</h2>

<p>Oh the app uses SSL as it should be doing. So we need an after-step mitmproxy and a certificate installed on the client. On Security menu is possible to install the certificate pushed to your phone.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">adb push ~/.mitmproxy/mitmproxy-ca-cert.cer /sdcard/</code></pre></div>

<h2 id="bank-sniffing">Bank sniffing</h2>

<p>After you play around the app you see the requests on MITMProxy, for example the account balance data for a known bank:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">&gt;&gt; POST https://m.santander.com.br/MbbNovoMobileServices/SetupEndpointService
&gt;&gt; POST https://m.santander.com.br/MbbNovoMobileServices/SaldoContaEndpointService

&lt;?xml version<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;1.0&#39;</span> encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf-8&#39;</span>?&gt;
&lt;soapenv:Envelope xmlns:soapenv<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://schemas.xmlsoap.org/soap/envelope/&#34;</span>&gt;
  &lt;soapenv:Body&gt;
    &lt;dlwmin:consultarExtratoPorPeriodoResponse xmlns:dlwmin<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://webservice.mbb.app.bsbr.altec.com/&#34;</span> xmlns:
      &lt;<span style="color:#66d9ef">return</span>&gt;
        &lt;lancamentos&gt;
          &lt;data&gt;15/12/2016&lt;/data&gt;
          &lt;docto/&gt;
          &lt;historico&gt;SALDO ANTERIOR&lt;/historico&gt;
          &lt;valor&gt;xxxx&lt;/valor&gt;
        &lt;/lancamentos&gt;
        &lt;lancamentos&gt;
          &lt;data&gt;15/12/2016&lt;/data&gt;
          &lt;docto&gt;xxx&lt;/docto&gt;
          &lt;historico&gt;xxxx <span style="color:#ae81ff">15</span>/12 yyy&lt;/historico&gt;
          &lt;valor&gt;-xx,00&lt;/valor&gt;
        &lt;/lancamentos&gt;
        &lt;lancamentos&gt;
          &lt;data&gt;16/12/2016&lt;/data&gt;
          &lt;docto&gt;xxx&lt;/docto&gt;
          &lt;historico&gt;xxxx <span style="color:#ae81ff">16</span>/12 yyy&lt;/historico&gt;
          &lt;valor&gt;-xx,00&lt;/valor&gt;
        &lt;/lancamentos&gt;
	...</code></pre></div>

<p>You can parse data via a crawler (scrapy is a good tool for this) and provide an interface for it, or you can integrate with Prometheus for example and create alerts for certain thresholds for you correlated account balance.</p>

<h2 id="captchas-bonus">Captchas (BONUS)</h2>

<p>One of the websites I had crawled a long time ago, had some captchas to move on, this is a method in python + Tesseract to clean up the captcha and read the content:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">	<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">captcha</span>(self):
   		im <span style="color:#f92672">=</span> array(Image<span style="color:#f92672">.</span>open(<span style="color:#e6db74">&#39;/tmp/what&#39;</span>)<span style="color:#f92672">.</span>convert(<span style="color:#e6db74">&#39;L&#39;</span>))
		<span style="color:#66d9ef">for</span> idx_row, row <span style="color:#f92672">in</span> enumerate(im):
			<span style="color:#75715e"># On grayscale get Max value (bg) and Min value (fg)</span>
			max_v <span style="color:#f92672">=</span> row<span style="color:#f92672">.</span>max()
			min_v <span style="color:#f92672">=</span> row<span style="color:#f92672">.</span>min()
			<span style="color:#66d9ef">if</span> idx_row <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>: <span style="color:#75715e"># Pass first one</span>
				<span style="color:#66d9ef">for</span> idx_col, col <span style="color:#f92672">in</span> enumerate(row): <span style="color:#75715e"># Iterate through cols</span>
					<span style="color:#66d9ef">try</span>:
						before <span style="color:#f92672">=</span> im[idx_row<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][idx_col]
						after <span style="color:#f92672">=</span> im[idx_row<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>][idx_col]
						<span style="color:#66d9ef">if</span> col <span style="color:#f92672">==</span> max_v <span style="color:#f92672">and</span> before <span style="color:#f92672">&lt;</span> max_v <span style="color:#f92672">and</span> after <span style="color:#f92672">&lt;</span> max_v:
							im[idx_row][idx_col] <span style="color:#f92672">=</span> before
					<span style="color:#66d9ef">except</span> <span style="color:#a6e22e">IndexError</span>:
						<span style="color:#66d9ef">pass</span>
		imx <span style="color:#f92672">=</span> Image<span style="color:#f92672">.</span>fromarray(im, mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;L&#39;</span>)
		<span style="color:#66d9ef">return</span> image_to_string(imx)<span style="color:#f92672">.</span>upper()<span style="color:#f92672">.</span>strip(<span style="color:#e6db74">&#39; &#39;</span>)</code></pre></div>

<h2 id="conclusion">Conclusion</h2>

<p>This was a quick post just to remember the power we have when ignoring the lame interfaces corps provides us to access the data, and use good methodologies and tools to grab it instead.</p>
<ul class="pa0">
  
</ul>
<div class="mt6">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "blog-ak.disqus.com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    </main>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-near-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://knabben.github.io/" >
    &copy; 2018 AK
  </a>
    <div>








</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
