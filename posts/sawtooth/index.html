<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>AK  | Hyperledger Sawtooth</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.54.0" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.e08a958ae3e530145318b6373195c765.css" rel="stylesheet">
    

    

    
      
    

    

    <meta property="og:title" content="Hyperledger Sawtooth" />
<meta property="og:description" content="Sawtooth A RUST permissioned/permissionless distribuded ledger created by Intel,
an official project under the Hyperledger umbrella. From the characteristics of the sawtooth we can have: distributed, immutable, secure.
There&#39;s a separation between the application level and the core system. It provides smartcontract abstraction that allows application developers to write contract logic in a language of their choice.
An application can be a native business logic or a smart contract virtual machine." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://knabben.github.io/posts/sawtooth/" />
<meta property="article:published_time" content="2019-06-02T16:50:00-04:00"/>
<meta property="article:modified_time" content="2019-06-02T16:50:00-04:00"/>

<meta itemprop="name" content="Hyperledger Sawtooth">
<meta itemprop="description" content="Sawtooth A RUST permissioned/permissionless distribuded ledger created by Intel,
an official project under the Hyperledger umbrella. From the characteristics of the sawtooth we can have: distributed, immutable, secure.
There&#39;s a separation between the application level and the core system. It provides smartcontract abstraction that allows application developers to write contract logic in a language of their choice.
An application can be a native business logic or a smart contract virtual machine.">


<meta itemprop="datePublished" content="2019-06-02T16:50:00-04:00" />
<meta itemprop="dateModified" content="2019-06-02T16:50:00-04:00" />
<meta itemprop="wordCount" content="705">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Hyperledger Sawtooth"/>
<meta name="twitter:description" content="Sawtooth A RUST permissioned/permissionless distribuded ledger created by Intel,
an official project under the Hyperledger umbrella. From the characteristics of the sawtooth we can have: distributed, immutable, secure.
There&#39;s a separation between the application level and the core system. It provides smartcontract abstraction that allows application developers to write contract logic in a language of their choice.
An application can be a native business logic or a smart contract virtual machine."/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="http://knabben.github.io/" class="f3 fw2 hover-white no-underline white-90 dib">
      AK
    </a>
    <div class="flex-l items-center">
      
      









    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  <article class="flex-l flex-wrap justify-between mw8 center ph3 ph0-l">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        POSTS
      </p>
      <h1 class="f1 athelas mb1">Hyperledger Sawtooth</h1>
      
      <time class="f6 mv4 dib tracked" datetime="2019-06-02T16:50:00-04:00">June 2, 2019</time>
    </header>

    <main class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><h2 id="sawtooth">Sawtooth</h2>

<p>A RUST permissioned/permissionless <a href="https://sawtooth.hyperledger.org/docs/core/releases/latest/introduction.html" title="distribuded ledger">distribuded ledger</a> created by Intel,</p>

<p>an official project under the Hyperledger umbrella. From the characteristics of the 
sawtooth we can have: distributed, immutable, secure.</p>

<p>There's a separation between the application level and the core system. It provides smartcontract 
abstraction that allows application developers to write contract logic in a language of their choice.</p>

<p>An application can be a native business logic or a smart contract virtual machine. 
In fact, both types of applications can co-exist on the same blockchain.</p>

<p>Each application defines the custom transaction processors for its unique requirements.</p>

<p>There're some distinticitve features of sawtooth: A REST API simplifies the client development by adapting validator
communication to standard HTTP/JSON. Parallel transaction execution. Event system. Ethereum contract
compatibility with Seth and Dynamic Consensus Algorithms given attention to the 
Proof of Elapsed Time, sesigned to be a production-grade protocol capable of supporting
large network populations.</p>

<h2 id="basic-setup-and-transaction-families">Basic setup and Transaction Families</h2>

<p>Transactions are the basis of the blockchain, this is the method information flows between 
nodes.</p>

<p>Sawtooth provides several examples transaction families to serve as model for
low-level functions (such as mantaining chain-wide settings and storing on-chain
oermissions). These specifications together with transaction processors give us an out-process
smart contract execution and global state storage.</p>

<p>Each application defines a custom Transaction processors for it's unique requirements, 
transaction processors SDKs are available in multiple languages to streamline creation of a 
new contrat languages.</p>

<h2 id="goals-for-this-post">Goals for this post</h2>

<p>Since we are using as example the XO transaction family, here are the goals, the repository is <a href="https://github.com/knabben/xo-sawtooth" title="here">here</a>:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#ae81ff">1</span><span style="color:#f92672">)</span> Use Tilt to improve the Kubernetes development experience
<span style="color:#ae81ff">2</span><span style="color:#f92672">)</span> Replace the actual TP to the Golang one
<span style="color:#ae81ff">3</span><span style="color:#f92672">)</span> Describe the transaction flow from </code></pre></div>

<h2 id="starting-the-example">Starting the example</h2>

<p>You can use <a href="https://github.com/kubernetes-sigs/kind" title="kind">kind</a> to create our test cluster, verify if it's working with:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ git clone https://github.com/knabben/xo-sawtooth.git
xo-sawtooth$ kind create cluster
xo-sawtooth$ tilt up</code></pre></div>

<p>A quick explanation of the PODs:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sawtooth-shell - Utils <span style="color:#66d9ef">for</span> interacting with the Sawtooth Blockchain
sawtooth-validator - Sawtooth core blockchain validator
sawtooth-devmode-engine - Random-leader consensus <span style="color:#66d9ef">for</span> development mode
sawtooth-settings-tp - Transaction processor <span style="color:#66d9ef">for</span> settings <span style="color:#f92672">(</span>required<span style="color:#f92672">)</span>
sawtooth-xo-tp-go - Transaction processor <span style="color:#66d9ef">for</span> XO family
sawtooth-rest-api - Validator REST API

<span style="color:#75715e"># You can look the deployments</span>

$ kubectl get pods
NAME                                  READY   STATUS    RESTARTS   AGE
sawtooth-684dcfdc6-6m4kx              <span style="color:#ae81ff">2</span>/2     Running   <span style="color:#ae81ff">0</span>          16m
sawtooth-rest-api-8968fcf8d-6gv2h     <span style="color:#ae81ff">1</span>/1     Running   <span style="color:#ae81ff">0</span>          16m
sawtooth-shell                        <span style="color:#ae81ff">1</span>/1     Running   <span style="color:#ae81ff">0</span>          15m
sawtooth-validator-5b465ddc69-ltclg   <span style="color:#ae81ff">2</span>/2     Running   <span style="color:#ae81ff">0</span>          16m</code></pre></div>

<h2 id="xo-create-game">XO Create game</h2>

<p>The shell box (make shell) contains the Python <a href="https://github.com/hyperledger/sawtooth-sdk-python/blob/master/examples/xo_python/sawtooth_xo/xo_cli.py#L497" title="entrypoint">entrypoint</a> for sawtooth-xo client</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">do_create</span>(args):
    name <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>name

    url <span style="color:#f92672">=</span> _get_url(args)
    keyfile <span style="color:#f92672">=</span> _get_keyfile(args)
    auth_user, auth_password <span style="color:#f92672">=</span> _get_auth_info(args)

    client <span style="color:#f92672">=</span> XoClient(base_url<span style="color:#f92672">=</span>url, keyfile<span style="color:#f92672">=</span>keyfile)

    <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>wait <span style="color:#f92672">and</span> args<span style="color:#f92672">.</span>wait <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
        response <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>create(
            name, wait<span style="color:#f92672">=</span>args<span style="color:#f92672">.</span>wait,
            auth_user<span style="color:#f92672">=</span>auth_user,
            auth_password<span style="color:#f92672">=</span>auth_password)
    <span style="color:#66d9ef">else</span>:
        response <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>create(
            name, auth_user<span style="color:#f92672">=</span>auth_user,
            auth_password<span style="color:#f92672">=</span>auth_password)

    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Response: {}&#34;</span><span style="color:#f92672">.</span>format(response))</code></pre></div>

<p>As you can see the XoClient is initiated with the client private key to sign up the transaction payload.</p>

<p>The <a href="https://github.com/hyperledger/sawtooth-sdk-python/blob/master/examples/xo_python/sawtooth_xo/xo_client.py#L187" title="_send_xo_txn">_send_xo_txn</a> function is responsible to create a TransactionHeader and a Transaction signed by the username.</p>

<p><a href="https://github.com/hyperledger/sawtooth-sdk-python/blob/master/examples/xo_python/sawtooth_xo/xo_client.py#L143" title="_send_request">_send_request</a> send the encoded Protobuf on base64 to the REST API - POST /batches.</p>

<h2 id="validation-and-rest-api">Validation and REST API</h2>

<p>Even if the transaction in only one it must send a batches, analyzing the <a href="https://github.com/hyperledger/sawtooth-core/blob/8085604594105ccc478072cafbd1bafe1f4948d6/rest_api/sawtooth_rest_api/route_handlers.py#L124" title="handler.submit_batches">handler.submit_batches</a> you have the
_query_validator sending the request to the validator - Uses an executor to send an asynchronous ZMQ request to the 
validator with the handler's Connection.</p>

<p>TL;DR - When the validator receives a transaction from a client, the validator confirms that the signature is valid, 
then send the transaction to the transaction processor to be executed.</p>

<h2 id="xo-transaction-processor">XO Transaction Processor</h2>

<p>The TP-XO listen for requests sent by the transaction processor and run in the handler:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#a6e22e">handler</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">xo</span>.<span style="color:#a6e22e">XoHandler</span>{}
<span style="color:#a6e22e">processor</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">processor</span>.<span style="color:#a6e22e">NewTransactionProcessor</span>(<span style="color:#a6e22e">endpoint</span>)
<span style="color:#a6e22e">processor</span>.<span style="color:#a6e22e">AddHandler</span>(<span style="color:#a6e22e">handler</span>)
<span style="color:#a6e22e">processor</span>.<span style="color:#a6e22e">ShutdownOnSignal</span>(<span style="color:#a6e22e">syscall</span>.<span style="color:#a6e22e">SIGINT</span>, <span style="color:#a6e22e">syscall</span>.<span style="color:#a6e22e">SIGTERM</span>)
<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">processor</span>.<span style="color:#a6e22e">Start</span>()</code></pre></div>

<p>The Apply from XoHandler is used by the processor to check the keys, is the case of create it validateCreate,
prints it and set the global state on <a href="https://github.com/hyperledger/sawtooth-core/blob/2f559397a71e69a79f713e11fb4731da9c6ce631/protos/validator.proto#L54" title="sawtooth validator">sawtooth validator</a> with xoState.SetGame(payload.Name, game) via the processor context.</p>

<h2 id="conclusion">Conclusion</h2>

<p>We had a very high level overview of the XO family transactions.</p>

<p>The capability of having a dynamic consensus and mainly this level of smartcontract decoupling, together
with the permissioned capability makes Sawtooth a very fast, reliable and secure solution for private 
blockchains.</p>

<p>If you want to learn more <a href="https://github.com/hyperledger/education-sawtooth-simple-supply" title="Sawtooth Simple Supply">Sawtooth Simple Supply</a> is a good source of documentation and example of how 
these pieces glues together.</p>
<ul class="pa0">
  
</ul>
<div class="mt6">
        
      </div>
    </main>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <script type="text/javascript" async
        src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
 MathJax.Hub.Config({
   tex2jax: {
     inlineMath: [['$','$'], ['\\(','\\)']],
     displayMath: [['$$','$$']],
     processEscapes: true,
     processEnvironments: true,
     skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
     TeX: { equationNumbers: { autoNumber: "AMS" },
            extensions: ["AMSmath.js", "AMSsymbols.js"] }
   }
 });
 MathJax.Hub.Queue(function() {
   
   
   
   var all = MathJax.Hub.getAllJax(), i;
   for(i = 0; i < all.length; i += 1) {
     all[i].SourceElement().parentNode.className += ' has-jax';
   }
 });

 MathJax.Hub.Config({
   
   TeX: { equationNumbers: { autoNumber: "AMS" } }
 });
</script>

<footer class="bg-near-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://knabben.github.io/" >
    &copy; 2019 AK
  </a>
    <div>








</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
