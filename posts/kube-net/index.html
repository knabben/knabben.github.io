<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>AK  | Networking</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.54.0" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.e08a958ae3e530145318b6373195c765.css" rel="stylesheet">
    

    
      <link rel="stylesheet" href="/css/custom.css">
    

    
      
    

    

    <meta property="og:title" content="Networking" />
<meta property="og:description" content="Networking The first and easiest way to access the Pod container port is via port-forward command:
$ kubectl port-forward &lt;pod_name&gt; &lt;local_port&gt;:&lt;remote_port&gt; Take a look on the dynamic port-forwarder.
Service An abstract way to expose an application running on a set of Pods as a network service.
a Service is an abstraction which defines a logical set of Pods and a policy by which to access them . The set of Pods targeted by a Service is usually determined by a selector." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://knabben.github.io/posts/kube-net/" />
<meta property="article:published_time" content="2019-12-28T23:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2019-12-28T23:00:00&#43;00:00"/>

<meta itemprop="name" content="Networking">
<meta itemprop="description" content="Networking The first and easiest way to access the Pod container port is via port-forward command:
$ kubectl port-forward &lt;pod_name&gt; &lt;local_port&gt;:&lt;remote_port&gt; Take a look on the dynamic port-forwarder.
Service An abstract way to expose an application running on a set of Pods as a network service.
a Service is an abstraction which defines a logical set of Pods and a policy by which to access them . The set of Pods targeted by a Service is usually determined by a selector.">


<meta itemprop="datePublished" content="2019-12-28T23:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2019-12-28T23:00:00&#43;00:00" />
<meta itemprop="wordCount" content="817">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Networking"/>
<meta name="twitter:description" content="Networking The first and easiest way to access the Pod container port is via port-forward command:
$ kubectl port-forward &lt;pod_name&gt; &lt;local_port&gt;:&lt;remote_port&gt; Take a look on the dynamic port-forwarder.
Service An abstract way to expose an application running on a set of Pods as a network service.
a Service is an abstraction which defines a logical set of Pods and a policy by which to access them . The set of Pods targeted by a Service is usually determined by a selector."/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="http://knabben.github.io/" class="f3 fw2 hover-white no-underline white-90 dib">
      AK
    </a>
    <div class="flex-l items-center">
      
      









    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  <article class="flex-l flex-wrap justify-between mw8 center ph3 ph0-l">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        POSTS
      </p>
      <h1 class="f1 athelas mb1">Networking</h1>
      
      <time class="f6 mv4 dib tracked" datetime="2019-12-28T23:00:00Z">December 28, 2019</time>
    </header>

    <main class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><h2 id="networking">Networking</h2>

<p>The first and easiest way to access the Pod container port is via port-forward command:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl port-forward &lt;pod_name&gt; &lt;local_port&gt;:&lt;remote_port&gt;</code></pre></div>

<p>Take a look on the dynamic <a href="https://github.com/knabben/forwarder" title="port-forwarder.">port-forwarder.</a></p>

<h2 id="service">Service</h2>

<p>An abstract way to expose an application running on a set of Pods as a network service.</p>

<p>a Service is an abstraction which defines a logical set of Pods and a policy by which to access them .
The set of Pods targeted by a Service is usually determined by a selector.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Service
metadata:
  name: nginx-svc
spec:
  selector:
    app: nginx
  ports:
    - protocol: TCP
      port: <span style="color:#ae81ff">80</span>
      targetPort: <span style="color:#ae81ff">80</span></code></pre></div>

<p>The service spec again, use the selector and when a Pod with this label matches the service will be used for that particular pod.</p>

<p>A new Service called nginx-deployment (which a DNS register is created - nginx-deployment.default.svc)</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl expose deployment nginx--port <span style="color:#ae81ff">80</span> --target-port <span style="color:#ae81ff">80</span>
Name:              nginx
Namespace:         default
Labels:            app<span style="color:#f92672">=</span>nginx
Annotations:       &lt;none&gt;
Selector:          app<span style="color:#f92672">=</span>nginx
Type:              ClusterIP
IP:                <span style="color:#ae81ff">10</span>.99.142.233
Port:              &lt;unset&gt;  <span style="color:#ae81ff">80</span>/TCP
TargetPort:        <span style="color:#ae81ff">80</span>/TCP
Endpoints:         <span style="color:#ae81ff">10</span>.244.0.18:80,10.244.0.19:80,10.244.0.20:80
Session Affinity:  None
Events:            &lt;none&gt;

$ curl http://nginx
<span style="color:#ae81ff">200</span></code></pre></div>

<p>We have some types of services:</p>

<ul>
<li>"ExternalName" maps to the specified externalName</li>
<li>"ClusterIP" allocates a cluster-internal IP address for load-balancing to endpoints</li>
<li>"None", no virtual IP is allocated and the endpoints are published as a set of endpoints rather than a stable IP</li>
<li>"NodePort" builds on ClusterIP and allocates a port on every node which routes to the clusterIP</li>
<li>"LoadBalancer" builds on NodePort and creates an external load-balancer (if supported in the current cloud)</li>
</ul>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#75715e">// ServiceSpec describes the attributes that a user creates on a service.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">ServiceSpec</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#75715e">// The list of ports that are exposed by this service.
</span><span style="color:#75715e"></span>	<span style="color:#75715e">// More info: https://kubernetes.io/docs/concepts/services-networking/service/#virtual-ips-and-service-proxies
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">Ports</span> []<span style="color:#a6e22e">ServicePort</span> <span style="color:#e6db74">`json:&#34;ports,omitempty&#34;`</span>

	<span style="color:#75715e">// Route service traffic to pods with label keys and values matching this
</span><span style="color:#75715e"></span>	<span style="color:#75715e">// selector.
</span><span style="color:#75715e"></span>	<span style="color:#75715e">// More info: https://kubernetes.io/docs/concepts/services-networking/service/
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">Selector</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;selector,omitempty&#34;`</span>

	<span style="color:#75715e">// clusterIP is the IP address of the service and is usually assigned
</span><span style="color:#75715e"></span>	<span style="color:#75715e">// randomly by the master.
</span><span style="color:#75715e"></span>	<span style="color:#75715e">// More info: https://kubernetes.io/docs/concepts/services-networking/service/#virtual-ips-and-service-proxies
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">ClusterIP</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;clusterIP,omitempty&#34;`</span>

	<span style="color:#75715e">// type determines how the Service is exposed.
</span><span style="color:#75715e"></span>	<span style="color:#75715e">// More info: https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services-service-types
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">Type</span> <span style="color:#a6e22e">ServiceType</span> <span style="color:#e6db74">`json:&#34;type,omitempty&#34;`</span>

	<span style="color:#75715e">// Only applies to Service Type: LoadBalancer
</span><span style="color:#75715e"></span>	<span style="color:#75715e">// +optional
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">LoadBalancerIP</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;loadBalancerIP,omitempty&#34;`</span>

	<span style="color:#75715e">// externalName is the external reference that kubedns or equivalent will
</span><span style="color:#75715e"></span>	<span style="color:#75715e">// return as a CNAME record for this service. No proxying will be involved.
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">ExternalName</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;externalName,omitempty&#34;`</span>
}</code></pre></div>

<p>kube-proxy is responsible for implementing a form of virtual IP for Services of type other than ExternalName.</p>

<h2 id="ingress">Ingress</h2>

<p>An API object that manages external access to the services in a cluster, typically HTTP.
Ingress exposes HTTP and HTTPS routes from outside the cluster to services within the cluster.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  name: test-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
  - host: hello.info
    http:
      paths:
      - path: /
        backend:
          serviceName: nginx-svc
          servicePort: <span style="color:#ae81ff">80</span></code></pre></div>

<h2 id="network-policies">Network policies</h2>

<p>A network policy is a specification of how groups of pods are allowed to communicate with each other and other network endpoints.
NetworkPolicy resources use labels to select pods and define rules which specify what traffic is allowed to the selected pods.</p>

<p>They can be Ingress or Egress in a Pod point of view.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#75715e">// Policy Type string describes the NetworkPolicy type
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">PolicyType</span> <span style="color:#66d9ef">string</span>

<span style="color:#66d9ef">const</span> (
	<span style="color:#75715e">// PolicyTypeIngress is a NetworkPolicy that affects ingress traffic on selected pods
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">PolicyTypeIngress</span> <span style="color:#a6e22e">PolicyType</span> = <span style="color:#e6db74">&#34;Ingress&#34;</span>
	<span style="color:#75715e">// PolicyTypeEgress is a NetworkPolicy that affects egress traffic on selected pods
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">PolicyTypeEgress</span> <span style="color:#a6e22e">PolicyType</span> = <span style="color:#e6db74">&#34;Egress&#34;</span>
)

<span style="color:#75715e">// NetworkPolicySpec provides the specification of a NetworkPolicy
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">NetworkPolicySpec</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#75715e">// Selects the pods to which this NetworkPolicy object applies. 
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">PodSelector</span> <span style="color:#a6e22e">metav1</span>.<span style="color:#a6e22e">LabelSelector</span> <span style="color:#e6db74">`json:&#34;podSelector&#34;`</span>

	<span style="color:#75715e">// List of ingress rules to be applied to the selected pods.
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">Ingress</span> []<span style="color:#a6e22e">NetworkPolicyIngressRule</span> <span style="color:#e6db74">`json:&#34;ingress,omitempty&#34;`</span>

	<span style="color:#75715e">// List of egress rules to be applied to the selected pods.
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">Egress</span> []<span style="color:#a6e22e">NetworkPolicyEgressRule</span> <span style="color:#e6db74">`json:&#34;egress,omitempty&#34;`</span>

	<span style="color:#75715e">// List of rule types that the NetworkPolicy relates to.
</span><span style="color:#75715e"></span>	<span style="color:#75715e">// Valid options are &#34;Ingress&#34;, &#34;Egress&#34;, or &#34;Ingress,Egress&#34;.
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">PolicyTypes</span> []<span style="color:#a6e22e">PolicyType</span> <span style="color:#e6db74">`json:&#34;policyTypes,omitempty&#34;`</span>
}

<span style="color:#75715e">// NetworkPolicyIngressRule describes a particular set of traffic that is allowed to the pods
</span><span style="color:#75715e">// matched by a NetworkPolicySpec&#39;s podSelector. The traffic must match both ports and from.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">NetworkPolicyIngressRule</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#75715e">// List of ports which should be made accessible on the pods selected for this
</span><span style="color:#75715e"></span>	<span style="color:#75715e">// rule.
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">Ports</span> []<span style="color:#a6e22e">NetworkPolicyPort</span> <span style="color:#e6db74">`json:&#34;ports,omitempty&#34;`</span>

	<span style="color:#75715e">// List of sources which should be able to access the pods selected for this rule.
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">From</span> []<span style="color:#a6e22e">NetworkPolicyPeer</span> <span style="color:#e6db74">`json:&#34;from,omitempty&#34;`</span>
}

<span style="color:#75715e">// NetworkPolicyEgressRule describes a particular set of traffic that is allowed out of pods
</span><span style="color:#75715e">// matched by a NetworkPolicySpec&#39;s podSelector. The traffic must match both ports and to.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">NetworkPolicyEgressRule</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#75715e">// List of destination ports for outgoing traffic.
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">Ports</span> []<span style="color:#a6e22e">NetworkPolicyPort</span> <span style="color:#e6db74">`json:&#34;ports,omitempty&#34;`</span>

	<span style="color:#75715e">// List of destinations for outgoing traffic of pods selected for this rule.
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">To</span> []<span style="color:#a6e22e">NetworkPolicyPeer</span> <span style="color:#e6db74">`json:&#34;to,omitempty&#34;`</span>
}</code></pre></div>

<p>An example of the usage of this NetworkPolicy capability, DENY all egress traffic from pod to source.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny
spec:
  podSelector: {}
  policyTypes:
  - Ingress</code></pre></div>

<p>PS: Not all CNIs have support for this feature.</p>

<h2 id="tasks">Tasks</h2>

<p>https://kubernetes.io/docs/tasks/access-application-cluster/connecting-frontend-backend/
https://kubernetes.io/docs/tasks/access-application-cluster/create-external-load-balancer/
https://kubernetes.io/docs/tasks/access-application-cluster/service-access-application-cluster/
https://kubernetes.io/docs/tasks/access-application-cluster/ingress-minikube/
https://kubernetes.io/docs/tasks/run-application/run-single-instance-stateful-application/
https://kubernetes.io/docs/tasks/run-application/run-replicated-stateful-application/</p>

<p>https://kubernetes.io/docs/tasks/access-application-cluster/port-forward-access-application-cluster/</p>
<ul class="pa0">
  
</ul>
<div class="mt6">
        
      </div>
    </main>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <script type="text/javascript" async
        src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
 MathJax.Hub.Config({
   tex2jax: {
     inlineMath: [['$','$'], ['\\(','\\)']],
     displayMath: [['$$','$$']],
     processEscapes: true,
     processEnvironments: true,
     skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
     TeX: { equationNumbers: { autoNumber: "AMS" },
            extensions: ["AMSmath.js", "AMSsymbols.js"] }
   }
 });
 MathJax.Hub.Queue(function() {
   
   
   
   var all = MathJax.Hub.getAllJax(), i;
   for(i = 0; i < all.length; i += 1) {
     all[i].SourceElement().parentNode.className += ' has-jax';
   }
 });

 MathJax.Hub.Config({
   
   TeX: { equationNumbers: { autoNumber: "AMS" } }
 });
</script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-46699622-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<footer class="bg-near-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://knabben.github.io/" >
    &copy; 2019 AK
  </a>
    <div>








</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
